
---
title: "Dispersal Model Graphs"
author: "Ruth Sharpe"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  word_document:
    reference_docx: FormatReferenceDoc.docx

---

```{r docSettings, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, comment = "", message = FALSE, fig.height=3, fig.width=6, dpi=300)

mytheme <- theme_bw(base_size=10)  + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    	panel.border = element_rect(fill = NA, colour = "black", linetype=1, size = 0.5), 
		legend.background = element_rect(fill="white", size=0.7, linetype="solid", colour ="black"), legend.text=element_text(size=6), 
		strip.background = element_rect(fill="white", size=0.7, linetype="solid", colour ="black"))

pointSize <- 1
lineSize <-0.5


# constant variables
env1<- 0.0
no_off <- 6 

subDispFile <- subset(importDispFile, Comp_meas != 0.5)
subDispFile <- subset(subDispFile, max_no_off == no_off & input_var == env1)
nrow(subDispFile)

xtabs(~ Comp_slope + ad_dsp_fd + input_var,  data = subDispFile)


```

# No environmental variation

## Metapopulation survival


```{r metSurv, , results = 'asis'}

aveFile <- ddply(subDispFile, .(ad_dsp_fd, Comp_meas), summarize, 
		metPopAgeMax = mean(metPopAgeMax))



ggplot(aveFile, aes(x = Comp_meas, y = log10(metPopAgeMax))) + 
		geom_point(size = pointSize, position = position_dodge(width = 0.02), aes(shape = as.factor(ad_dsp_fd))) + 
		geom_line(size = lineSize, aes(linetype = as.factor(ad_dsp_fd))) + mytheme + ylab("Log metapopulation survival") + 
		scale_shape_discrete("Dispersal\nMin Size") + scale_linetype_discrete("Dispersal\nMin Size") + 
		xlab("Competition measure") +
		scale_y_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 3.0))


```

(@) _Figure [MetSurv]:Metapopulation survival against competition type, where
competition type ranges from 0 to 1, with 0 being full scramble competition and
1 is full contest competition. Environmental variance is `r env1` and number of
offspring set to `r no_off`. No generations removed_



Metapopulation survival against population survival
---


```{r MetSurvPop}

ggplot(subDispFile, aes(x = log10(survivalMean_all), y = log10(metPopAgeMax))) +
		mytheme +
		geom_smooth(se = FALSE, method = "lm", formula = y ~ x -I(x^2) + exp(x), color = "black", size = 0.4, aes(linetype = as.factor(ad_dsp_fd))) + 
		geom_point(size = pointSize, color = "black", position = position_jitter(w = 0.01, h = 0.05), aes(shape = as.factor(ad_dsp_fd))) + 
		ylab("Log metapopulation survival") + 
		xlab("Log population survival") +
		scale_y_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 2.7)) +
		scale_x_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 3.0)) + 
		scale_linetype_discrete("Dispersal\nMin Size") + 
		scale_shape_discrete("Dispersal\nMin Size")


```

(@) _Figure [MetSurvPop] :Metapopulation against population survival.
Environmental variance is `r env1` and number of offspring set to `r no_off`.
All generations included. Survival calculated from survival function_




Metapopulation survival and dispersal
---


```{r MetDis}
	
aveFile <- ddply(subDispFile, .(ad_dsp_fd, Comp_meas), summarize, 
		any_disp = mean(any_disp),
		metPopAgeMax = mean(metPopAgeMax))


ggplot(aveFile, aes(x = any_disp, y = log10(metPopAgeMax))) + 
		stat_smooth(method = "lm",  formula  = y~exp(-x),se = FALSE, color = "black", size = 0.5) + 
		mytheme + 
		geom_point(size = pointSize, position = position_jitter(w = 0.07, h = 0.02),  aes(shape = as.factor(ad_dsp_fd))) + 
		ylab("Log metapopulation survival") + 
		xlab("Did any dispersal take place?") + scale_shape_discrete("Dispersal\nMin Size") + 
		scale_x_continuous(breaks=seq(0, 1.0, by=1), limits = c(-0.2, 1.2))

```
 
(@) _Figure [MetDis]: Comparing metapopulation survival to whether any populations produced dispersers_ 




What affects dispersal?
---

```{r Disp, fig.height=3, fig.width=4}

ave_subDispFile<- ddply(subDispFile, .(Comp_meas, ad_dsp_fd), summarise,
		N_all = length(!is.na(fileNum)),
		meanDispBin = mean(any_disp, na.rm = FALSE))

ggplot(ave_subDispFile, aes(x = as.factor(Comp_meas), y = as.factor(ad_dsp_fd), fill = meanDispBin))  + 
		geom_tile(colour = "white", size=0.1) +
		mytheme + ylab("Minimum Adult dispersal size") +  xlab("Competition") + 
		scale_fill_gradient(low="black", high="grey80", guide = FALSE) +
		geom_rect(data = ave_subDispFile, aes(xmin=2.5, xmax=3.5, ymin=2.5, ymax=3.5), fill='grey25', colour = 'white', alpha=0.01)

```

(@) _Figure [Disp]: Comparing metapopulation survival to whether any populations produced dispersers_ 


# With environmental variance

```{r EnvMetPop, include = FALSE}

set_ad_dsp_fd1 <- 0.8
set_ad_dsp_fd2 <- 0.6

subDispFile <- subset(importDispFile, max_no_off == no_off)

subDispFile <- subset(subDispFile, Comp_meas != 0.5)

#disaves_subVar <-  subset(dis_aves, max_no_off == no_off)
#disaves_subVar <- subset(disaves_subVar, ad_dsp_fd == set_ad_dsp_fd1 | ad_dsp_fd == set_ad_dsp_fd2)


```

## Metapopulation Survival

```{r EnvMetSurv, fig.height=4}
#geom_smooth(se = FALSE, method = "lm", formula = y ~ x + I(x^2))

subSubFile <- subset(subDispFile, ad_dsp_fd == 0.6 | ad_dsp_fd == 0.8)

appender <- function(string, myText = "Dispersal Size:") paste0(myText, string)

ggplot(subSubFile, aes(x = input_var, y = log10(metPopAgeMax))) + 
		geom_point(size = pointSize, position = position_jitter(w = 0, h = 0), aes(shape = as.factor(Comp_meas))) + 
		geom_smooth(se = FALSE, method = "lm", formula = y ~ x + I(x^2)+ exp(-x), color = "black", size = 0.4, aes(linetype = as.factor(Comp_meas))) + 
		mytheme + ylab("Log max metapopulation age") + 
		scale_linetype_discrete("Competition") + 
		scale_shape_discrete("Competition") + 
		xlab("Environmental variation") +
		scale_y_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 2.7)) + 
		facet_grid(ad_dsp_fd~., labeller = as_labeller(appender))
```

(@) _Figure [EnvMetSurv]:Metapopulation survival environmental variance. Number of offspring
set to `r no_off`. All generations included_


## Population Survival

```{r EnvPopSurv, fig.height=4}

appender <- function(string, myText = "Dispersal Size:") paste0(myText, string)

ggplot(subSubFile , aes(x = input_var, y = log10(survivalMean_all))) + 
		geom_point(size = pointSize, position = position_jitter(w = 0, h = 0), aes(shape = as.factor(Comp_meas))) + 
		geom_smooth(se = FALSE, method = "lm", formula = y ~ x + I(x^2)+ exp(-x), color = "black", size = 0.4, aes(linetype = as.factor(Comp_meas))) + 
		mytheme + ylab("Log max metapopulation age") + 
		scale_linetype_discrete("Competition") + 
		scale_shape_discrete("Competition") + 
		xlab("Environmental variation") +
		scale_y_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 2.7)) + 
		facet_grid(ad_dsp_fd~., labeller = as_labeller(appender))
```

(@) _Figure [EnvPopSurv]:Metapopulation survival environmental variance. Number of offspring
set to `r no_off`. All generations included_

## Metapopulation vs population survival by minimum disperal size



```{r EnvMetSurvPop}

ggplot(subDispFile, aes(x = log10(survivalMean_all), y = log10(metPopAgeMax))) + 
		geom_point(size = pointSize, position = position_jitter(w = 0, h = 0.05), aes(shape = as.factor(ad_dsp_fd))) + 
		mytheme + ylab("Log max metapopulation age") + 
		geom_smooth(se= FALSE, color = "black", aes(linetype = as.factor(ad_dsp_fd)), size = 0.4) +
		scale_linetype_discrete("Adult Dispersal Limit") + 
		scale_shape_discrete("Adult Dispersal Limit") +
		xlab("Population Survival") +
		scale_y_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 2.7)) +
		scale_x_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 2.7))
```

(@) _Figure [EnvMetSurvPop]_

# Metapopulation survival and dispersal

```{r EnvMetDisp, fig.height=3.5, fig.width=10}

appender <- function(string, myText = "Competition:") paste0(myText, string)


ggplot(subDispFile, aes(x = any_disp, y = log10(metPopAgeMax))) + 
		stat_smooth(se = FALSE, color = "black", size = 0.4, method = "lm", formula = y ~ x + I(x^2)+ exp(-x)) + 
		mytheme + 
		geom_point(size = pointSize, position = position_jitter(w = 0.07, h = 0.02),  aes(shape = as.factor(ad_dsp_fd))) + 
		ylab("Log metapopulation survival") + 
		xlab("Did any dispersal take place?") + scale_shape_discrete("Dispersal\nMin Size") + 
		scale_x_continuous(breaks=seq(0, 1.0, by=1), limits = c(-0.2, 1.2)) +
		facet_grid(~Comp_meas, labeller = as_labeller(appender)) +
		theme(legend.position="bottom")

```

(@) _Figure [EnvMetDisp]_

What restricts dispersal?
---

```{r EnvDisp, fig.height=3, fig.width=4}


ave_subDispFile<- ddply(subDispFile, .(Comp_meas, ad_dsp_fd), summarise,
		N_all = length(!is.na(fileNum)),
		meanDispBin = mean(any_disp, na.rm = FALSE))

ggplot(ave_subDispFile, aes(x = as.factor(Comp_meas), y = as.factor(ad_dsp_fd), fill = meanDispBin))  + geom_tile(colour = "white", size=0.1) +
		mytheme + ylab("Minimum Adult dispersal size") +  xlab("Competition") + 
		scale_fill_gradient(low="black", high="grey80", guide = FALSE) 
		#facet_wrap(~input_var)

```

(@) _Figure [EnvDisp]: Comparing metapopulation survival to whether any
populations produced dispersers. From comparing figure (above) to figure
(other), we can see that disperal has gone from zero to some dispersal when size
is 0.6 and competition is 0, size is 0.8, comp is zero, and when size is 0.8 and
comp is 0.2_


Disperal amount and environmental variation
---

```{r EnvVarDisp, fig.height=3, fig.width=6}

dispEnv <- subset(subDispFile, (ad_dsp_fd == 0.6 & Comp_meas == 0) | (ad_dsp_fd == 0.8 & Comp_meas == 0) | (ad_dsp_fd == 0.8 & Comp_meas == 0.2))

dispEnv$all_ave_num_disp <- ifelse(is.na(dispEnv$all_ave_num_disp) == TRUE , 0, dispEnv$all_ave_num_disp)

dispEnv$Legend <- ifelse(dispEnv$ad_dsp_fd == 0.6 & dispEnv$Comp_meas == 0, "Comp=0.0, Size=0.6", 
		ifelse(dispEnv$ad_dsp_fd == 0.8 & dispEnv$Comp_meas == 0, "Comp=0.0, Size=0.8", 
				ifelse(dispEnv$ad_dsp_fd == 0.8 & dispEnv$Comp_meas == 0.2, "Comp=0.2, Size=0.8", "MISTAKE")))

dispSum <- summarySE(dispEnv, measurevar="all_ave_num_disp", groupvars=c("input_var","Legend"))

ggplot(dispSum, aes(x=input_var, y=all_ave_num_disp)) + 
    geom_errorbar(aes(ymin=all_ave_num_disp-se, ymax=all_ave_num_disp+se), width=.03) +
    geom_point(size = 2, aes(shape = Legend)) + mytheme+
	geom_line(aes(linetype = Legend)) +
    xlab("Environmental variation") + ylab("Number colonies dispersing") +
	scale_shape_manual(values=c(0, 2, 19)) +
	scale_linetype_manual(values=c(6, 2, 1))
    
 ```

(@) _Figure [EnvVarDisp]: Average of log10 number of dispersers per time
step_ 
 