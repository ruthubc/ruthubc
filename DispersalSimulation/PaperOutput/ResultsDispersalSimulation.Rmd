
---
title: "Dispersal Model Graphs"
author: "Ruth Sharpe"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  word_document:
    reference_docx: FormatReferenceDoc.docx

---

```{r docSettings, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, comment = "", message = FALSE, fig.height=3, fig.width=6, dpi=300)

mytheme <- theme_bw(base_size=10)  + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
    	panel.border = element_rect(fill = NA, colour = "black", linetype=1, size = 0.5), 
		legend.background = element_rect(fill="white", size=0.7, linetype="solid", colour ="black"), legend.text=element_text(size=6), 
		strip.background = element_rect(fill="white", size=0.7, linetype="solid", colour ="black"))

pointSize <- 1
lineSize <-0.5


# constant variables
env1<- 0.0
no_off <- 6 

subDispFile <- subset(importDispFile, Comp_meas != 0.5)
subDispFile <- subset(subDispFile, max_no_off == no_off & input_var == env1)
nrow(subDispFile)

xtabs(~ Comp_slope + ad_dsp_fd + input_var,  data = subDispFile)


```

# Metapopulation survival with no environmental variation


### Interaction between intraspecific competition type and dispersal constraint


```{r metapop, , results = 'asis'}

aveFile <- ddply(subDispFile, .(ad_dsp_fd, Comp_meas), summarize, 
		metPopAgeMax = mean(metPopAgeMax))



ggplot(aveFile, aes(x = Comp_meas, y = log10(metPopAgeMax))) + 
		geom_point(size = pointSize, position = position_dodge(width = 0.02), aes(shape = as.factor(ad_dsp_fd))) + 
		geom_line(size = lineSize, aes(linetype = as.factor(ad_dsp_fd))) + mytheme + ylab("Log metapopulation survival") + 
		scale_shape_discrete("Dispersal\nMin Size") + scale_linetype_discrete("Dispersal\nMin Size") + 
		xlab("Competition measure") +
		scale_y_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 3.0))


```

(@) _Figure :Metapopulation survival against competition type, where competition
type ranges from 0 to 1, with 0 being full scramble competition and 1 is full
contest competition. Environmental variance is `r env1` and number of offspring
set to `r no_off`. No generations removed_


As competition changes from scramble to contest competition the metapopulation
age increases, but this interacts with the body size needed to disperse, unless
the populations survive to 500 generations, in which cases obviously.

**Both dipsersal and intraspecific compeition type affects metapopulation survival**


#### Why dispersal increases metapopulation survival?

The simulation only starts with x number of colonies, but there are ‘spaces’ for
200. More dispersal means that these spaces get filled up. 

#### How does this interact with competition? 

If food is shared via contest competition then normally some individuals will
get enough food to disperse, even if individuals have to be large to disperse. 
However if food is shared via contest competition then this is not the case.




Metapopulation survival against population survival
---


```{r MetSurvpopSurv}




ggplot(subDispFile, aes(x = log10(survivalMean_all), y = log10(metPopAgeMax), colour = as.factor(ad_dsp_fd))) +
		mytheme +
		geom_point(size = pointSize, position = position_jitter(w = 0, h = 0.05)) + 
		ylab("Log metapopulation survival") + 
		xlab("Log population survival") +
		scale_y_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 3.0)) +
		scale_x_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 3.0)) + 
		scale_colour_discrete("Dispersal\nMin Sixe")


```

(@) _Figure :Metapopulation against population survival. Environmental variance
is `r env1` and number of offspring set to `r no_off`. All generations included.
Survival calculated from survival function_

From this graph we can see that dispersal affects whether populations survival
affects metapopulation survival. When the size needed to disperse is 0.2 (i.e.
low) then the metapopulation survives to 500 generations regardless of the
survival of the populations. The higher the disperal size is, the more the
population survival affects the metapopulation survival.


Metapopulation survival and dispersal
---


```{r MetSurvTotNumDispersers}
	
aveFile <- ddply(subDispFile, .(ad_dsp_fd, Comp_meas), summarize, 
		any_disp = mean(any_disp),
		metPopAgeMax = mean(metPopAgeMax))


ggplot(aveFile, aes(x = any_disp, y = log10(metPopAgeMax))) + 
		stat_smooth(method = "lm",  formula  = y~exp(-x),se = FALSE, color = "black", size = 0.5) + 
		mytheme + 
		geom_point(size = pointSize, position = position_jitter(w = 0.07, h = 0.02),  aes(shape = as.factor(ad_dsp_fd))) + 
		ylab("Log metapopulation survival") + 
		xlab("Did any dispersal take place?") + scale_shape_discrete("Dispersal\nMin Size") + 
		scale_x_continuous(breaks=seq(0, 1.0, by=1), limits = c(-0.2, 1.2))




```
 
(@) _Figure : Comparing metapopulation survival to whether any populations produced dispersers_ 

This shows how metapopulations have short survival if dispersal is restricted, but that metapopulations can survive no dispersal if competition within populations is contest like.

x2 outliners 



What affects dispersal?
---
### make summary file for this graph

```{r WhatAfftsDispersal, fig.height=3, fig.width=4}

ave_subDispFile<- ddply(subDispFile, .(Comp_meas, ad_dsp_fd), summarise,
		N_all = length(!is.na(fileNum)),
		meanDispBin = mean(any_disp, na.rm = FALSE))

ggplot(ave_subDispFile, aes(x = as.factor(Comp_meas), y = as.factor(ad_dsp_fd), fill = meanDispBin))  + geom_tile(colour = "white", size=0.1) +
		mytheme + ylab("Minimum Adult dispersal size") +  xlab("Competition") + 
		scale_fill_gradient(low="grey70", high="grey18", guide = FALSE)

```

(@) _Figure : Comparing metapopulation survival to whether any populations produced dispersers_ 

This shows how metapopulations have short survival if dispersal is restricted, but that metapopulations can survive no dispersal if competition within populations is contest like.



Conclusion
---
Competition affects population survival and therefore metapopulation survival,
but low population survival is off-set by disperal to increase metapopulation
survival.


Metapopulation and population survival and environmental variance
===


```{r envFile, include = FALSE}

set_ad_dsp_fd1 <- 0.8
set_ad_dsp_fd2 <- 0.6

subDispFile <- subset(importDispFile, max_no_off == no_off)

subDispFile <- subset(subDispFile, Comp_meas != 0.5)

#disaves_subVar <-  subset(dis_aves, max_no_off == no_off)
#disaves_subVar <- subset(disaves_subVar, ad_dsp_fd == set_ad_dsp_fd1 | ad_dsp_fd == set_ad_dsp_fd2)


```

Population Survival against environmental variation 
---
```{r poppopVar, fig.height=9}

appender <- function(string, myText = "Dispersal Size:") paste0(myText, string)

ggplot(subDispFile, aes(x = input_var, y = log10(survivalMean_all))) + 
		geom_point(size = pointSize, position = position_jitter(w = 0, h = 0), aes(shape = as.factor(Comp_meas))) + 
		geom_smooth(se = FALSE, method = "lm", formula = y ~ x + I(x^2)+ exp(-x), color = "black", size = 0.4, aes(linetype = as.factor(Comp_meas))) + 
		mytheme + ylab("Log max metapopulation age") + 
		scale_linetype_discrete("Competition") + 
		scale_shape_discrete("Competition") + 
		xlab("Environmental variation") +
		scale_y_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 2.7)) + 
		facet_grid(ad_dsp_fd~., labeller = as_labeller(appender))
```

(@) _Figure :Metapopulation survival environmental variance. Number of offspring
set to `r no_off`. All generations included_

How much environmental variation affects population survival depends on
intraspecific competition form

Metapopulation Survival
---
```{r metapopVar, fig.height=9}
#geom_smooth(se = FALSE, method = "lm", formula = y ~ x + I(x^2))

appender <- function(string, myText = "Dispersal Size:") paste0(myText, string)

ggplot(subDispFile, aes(x = input_var, y = log10(metPopAgeMax))) + 
		geom_point(size = pointSize, position = position_jitter(w = 0, h = 0), aes(shape = as.factor(Comp_meas))) + 
		geom_smooth(se = FALSE, method = "lm", formula = y ~ x + I(x^2)+ exp(-x), color = "black", size = 0.4, aes(linetype = as.factor(Comp_meas))) + 
		mytheme + ylab("Log max metapopulation age") + 
		scale_linetype_discrete("Competition") + 
		scale_shape_discrete("Competition") + 
		xlab("Environmental variation") +
		scale_y_continuous(breaks=seq(0, 3.0, by=0.5), limits = c(0, 2.7)) + 
		facet_grid(ad_dsp_fd~., labeller = as_labeller(appender))
```

(@) _Figure :Metapopulation survival environmental variance. Number of offspring
set to `r no_off`. All generations included_

Intermediate environmental variance increases metapopulation survival for some
competition measures when dispersal is restricted.



Population Survival vs Metapopulation survival by Adult Dispersal Size
---

```{r MetSurvVsPopSurvAdFd}

ggplot(subDispFile, aes(x = log10(survivalMean_all), y = log10(metPopAgeMax))) + 
		geom_point(size = pointSize, position = position_jitter(w = 0, h = 0.05), aes(shape = as.factor(ad_dsp_fd))) + 
		mytheme + ylab("Log max metapopulation age") + 
		geom_smooth(se= FALSE, color = "black", aes(linetype = as.factor(ad_dsp_fd)), size = 0.4) +
		scale_linetype_discrete("Adult Dispersal Limit") + 
		scale_shape_discrete("Adult Dispersal Limit") +
		xlab("Population Survival")
```

# Binary dispersal faceted by competition

```{r MetSurvTotNumDispersersEnv, fig.height=6, fig.width=10}

appender <- function(string, myText = "Competition:") paste0(myText, string)


ggplot(subDispFile, aes(x = any_disp, y = log10(metPopAgeMax))) + 
		stat_smooth(se = FALSE, color = "black", size = 0.4, method = "lm", formula = y ~ x + I(x^2)+ exp(-x)) + 
		mytheme + 
		geom_point(size = pointSize, position = position_jitter(w = 0.07, h = 0.02),  aes(shape = as.factor(ad_dsp_fd))) + 
		ylab("Log metapopulation survival") + 
		xlab("Did any dispersal take place?") + scale_shape_discrete("Dispersal\nMin Size") + 
		scale_x_continuous(breaks=seq(0, 1.0, by=1), limits = c(-0.2, 1.2)) +
		facet_wrap(~Comp_meas, labeller = as_labeller(appender))
	


```
