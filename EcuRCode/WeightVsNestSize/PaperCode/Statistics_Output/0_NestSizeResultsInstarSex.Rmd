
---
title: "Weight Vs Colony Size Results with instar as numeric"
author: "Ruth Sharpe"
date: "`r format(Sys.time(), '%d %B, %Y')`"
---

```{r docSettings, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, comment = "", message = FALSE)
modelList <- c()
	
```
note:
All models had to include nest size and instar number.

Leg Vs. Nest Size
--------------------

```{r LegNS, results='asis',  echo = FALSE}
##### Leg length vs colony size

FullModel <- lmer(logLeg ~ logCtFm + InstarNumber + logCtFm:InstarNumber + logCtFm:InstarNumber:InstarSex +  
    			(1 | NestID), data = spidersMul, REML = FALSE)

NSModel <- update(FullModel, .~. - logCtFm -logCtFm:InstarNumber - logCtFm:InstarNumber:InstarSex)


NSResults <- outputResultsWord(FullModel, NSModel)

modelList <- c(modelList, docxFmula(FullModel))

	
```
The model with the lowest AIC had nest size x instar age and the
three-way interaction nest size x instar age x instar sex as fixed effects.
Using this as the full model and all the terms that include nest size removed
as the reduced model, we found that leg length increases as colony size
increases (lmer; $\chi$^2^~`r NSResults[[1]]` ,`r NSResults[[2]]`~=
`r NSResults[[3]]`, p = `r NSResults[[4]]` `r NSResults[[5]]`, figure 1).


```{r LegInstarNumber, results='asis',  echo = FALSE}
##### Leg length vs instar

InstarModel <- update(FullModel, .~. - InstarNumber -logCtFm:InstarNumber - logCtFm:InstarNumber:InstarSex)

InstarResults <- outputResultsWord(FullModel, InstarModel)

	
```

Leg length was significantly correlated with instar age, but that is not surprising due to their different physiology (lmer; $\chi$^2^~`r InstarResults[[1]]`
,`r InstarResults[[2]]`~= `r InstarResults[[3]]`, p = `r InstarResults[[4]]`
`r InstarResults[[5]]`).


```{r LegInstarSex, results='asis',  echo = FALSE}
##### Leg length vs instar

InstarSexModel <- update(FullModel, .~. - logCtFm:InstarNumber:InstarSex)

InstarSexResults <- outputResultsWord(FullModel, InstarModel)
	
```

In addition, the interaction nest size x instar age x instar sex was
significant, (lmer; $\chi$^2^~`r InstarSexResults[[1]]`
,`r InstarSexResults[[2]]`~= `r InstarSexResults[[3]]`, p =
`r InstarSexResults[[4]]` `r InstarSexResults[[5]]`), with male leg size
changing faster with nest size compared to females.

In addition the effect of colony size on spider size was not significant in the
youngest instars (Table 1); it was first detectable in subadult males and
females.



```{r LegIndInstar, results='asis',  echo = FALSE}
##### Leg length vs interaction

FullModel <- lmer(logLeg ~  logCtFm +  (1|NestID)  , data = subset(spidersMul, Instar == "Adult"))
RedModel <- lmer(logLeg ~  (1|NestID)  , data = subset(spidersMul, Instar == "Adult"))

AdultRes <- outputResultsWord(FullModel, RedModel)

FullModel <- lmer(logLeg ~  logCtFm +  (1|NestID)  , data = subset(spidersMul, Instar == "Sub2"))
RedModel <- lmer(logLeg ~  (1|NestID)  , data = subset(spidersMul, Instar == "Sub2"))

Sub2Res <- outputResultsWord(FullModel, RedModel)

FullModel <- lmer(logLeg ~  logCtFm +  (1|NestID)  , data = subset(spidersMul, Instar == "Sub1"))
RedModel <- lmer(logLeg ~  (1|NestID)  , data = subset(spidersMul, Instar == "Sub1"))

Sub1Res <- outputResultsWord(FullModel, RedModel)

FullModel <- lmer(logLeg ~  logCtFm +  (1|NestID)  , data = subset(spidersMul, Instar == "Juv4"))
RedModel <- lmer(logLeg ~  (1|NestID)  , data = subset(spidersMul, Instar == "Juv4"))

Juv4Res <- outputResultsWord(FullModel, RedModel)

FullModel <- lmer(logLeg ~  logCtFm +  (1|NestID)  , data = subset(spidersMul, Instar == "AdMale"))
RedModel <- lmer(logLeg ~  (1|NestID)  , data = subset(spidersMul, Instar == "AdMale"))

AdMaleRes <- outputResultsWord(FullModel, RedModel)

FullModel <- lmer(logLeg ~  logCtFm +  (1|NestID)  , data = subset(spidersMul, Instar == "SubMale"))
RedModel <- lmer(logLeg ~  (1|NestID)  , data = subset(spidersMul, Instar == "SubMale"))

SubMaleRes <- outputResultsWord(FullModel, RedModel)
	
```

Testing each instar separately, the only juvenile stage 4 and subadult stage 1
spiders did not show a significant decrease in leg length with colony size (table
1). 

| Instar   |      $\chi$^2^        |  p value                                | 
|----------|---------------------|--------------------------------------| 
|Juv4 | `r (Juv4Res[[3]])` |   `r Juv4Res[[4]]` `r Juv4Res[[5]]`  | 
| Sub1 | `r (Sub1Res[[3]])` |   `r Sub1Res[[4]]` `r Sub1Res[[5]]`  | 
| Sub2 | `r (Sub2Res[[3]])` |   `r Sub2Res[[4]]` `r Sub2Res[[5]]`  | 
|Adult  |  `r (AdultRes[[3]])` |`r AdultRes[[4]]` `r AdultRes[[5]]`  |  
|Sub Male| `r (SubMaleRes[[3]])` |   `r SubMaleRes[[4]]` `r SubMaleRes[[5]]`  | 
|Adult Male | `r (AdMaleRes[[3]])` |   `r AdMaleRes[[4]]` `r AdMaleRes[[5]]`  | 


Table 1: Statistical results of leg length against colony size for each
instar tested individually

```{r LegGraph, fig.height=7, fig.width=13}

FullModel <- lmer(logLeg ~  logCtFm + Instar + logCtFm:Instar  + 
				(1|NestID)  , data = spidersMul, REML = FALSE)



InstarGridGraph(spidersMul, "logLeg", "Leg Length - log transformed", "n", "", FullModel)

```
  
(@) Figure:  Leg length against colony size. The overlaid model
is `r as.character(FullModel@call[2])`. Overall leg length decreases with
colony size (p = `r NSResults[[4]]` `r NSResults[[5]]`) and there was a
significant interaction with instar (p = `r InstarResults[[4]]`
`r InstarResults[[5]]`).


Condition Vs. Colony Size
--------------------


```{r CondNS, results='asis',  echo = FALSE}
##### Leg length vs colony size


FullModel <- lmer(condResiduals ~  logCtFm + logCtFm:InstarNumber  +  (1|NestID), data = spidersMul, REML = FALSE)
NSModel <- update(FullModel, ~ . - logCtFm - logCtFm:InstarNumber)

NSResults <- outputResultsWord(FullModel, NSModel)

modelList <- c(modelList, docxFmula(FullModel))
	
```
The model with the lowest AIC included colony size and instar x colony size interaction.
Nest size combined with the nest size x instar interaction was significant (lmer; $\chi$^2^~`r NSResults[[1]]`
,`r NSResults[[2]]`~= `r NSResults[[3]]`, p = `r NSResults[[4]]`
`r NSResults[[5]]`).


```{r ConditionInteraction, results='asis',  echo = FALSE}
##### Leg length vs instar

InstarModel <- update(FullModel, ~ . - logCtFm)
Results <- outputResultsWord(FullModel, InstarModel)

FullModelAds <- lmer(condResiduals ~  logCtFm +  (1|NestID)  , data = subset(spidersMul, Instar == "Adult"))
RedModel <- lmer(condResiduals ~  (1|NestID)  , data = subset(spidersMul, Instar == "Adult"))
AdultResults <- outputResultsWord(FullModelAds, RedModel)
		
	
```
There was a significant interaction between instar and colony size (lmer; $\chi$^2^~`r Results[[1]]`,`r Results[[2]]`~ =
`r Results[[3]]`, p = `r Results[[4]]` `r Results[[5]]`), with condition appearing to decrease faster with nest size as the instars 
increase in age (figure 3).

However, when performing ad-hoc tests on the instars individually we find that only adult 
condition decreases with colony size (lmer; $\chi$^2^~`r AdultResults[[1]]`,`r AdultResults[[2]]`~ =
`r AdultResults[[3]]`, p = `r AdultResults[[4]]` `r AdultResults[[5]]`).


```{r ConditionGraph, fig.height=7, fig.width=13}

InstarGridGraph(spidersMul, "condResiduals", "Individual Condition", "n", "", FullModel, "y")


```
  
(@)  Figure : Individual condition against colony size. The overlaid model is
`r as.character(FullModel@call[2])`. Overall leg length decreases with colony size
(p = `r NSResults[[4]]` `r NSResults[[5]]`) and there was a significant
interaction with instar(p = `r InstarResults[[4]]` `r InstarResults[[5]]`).



```{r InstarConditionGraph, fig.height=7, fig.width=13}

a_predictDF <- expand.grid(logCtFm = seq(min(spidersMul$logCtFm), max(spidersMul$logCtFm), by = 0.1), 
		InstarNumber = c(4, 5, 6, 7), NestID = c("44.4EX12"))


a_predictDF$lmrPrd <- predict(FullModel, a_predictDF)

ggplot(data = a_predictDF, aes(x = logCtFm, y = lmrPrd, colour = as.factor(InstarNumber))) + geom_line(size = 1) + mytheme +
		ylab("Predicted Condition") + xlab("Log Count Females") + scale_colour_discrete(name = "Instar Age")

```
  
(@)  Figure : The results of the linear model showing individual condition of each instar age against nest size. However only adults had a significant effect.



Within Colony Variance Vs. colony size
--------------------

### Leg Length Variance


```{r LegLenVarNS, results='asis',  echo = FALSE}
##### Leg length vs colony size

minN <- 2
legVarUpdate <- subset(legVar, N > minN)
totSpis <- sum(legVarUpdate$N)
legVarUpdate$lmrWgts <- legVarUpdate$N/ totSpis



FullModel <- lmer(relativeVar ~ logCtFm + InstarNumber + InstarNumber:InstarSex + logCtFm:InstarNumber + I(InstarNumber^2) + (1|NestID), weights = lmrWgts,
    	data = legVarUpdate, REML = FALSE)

modelList <- c(modelList, docxFmula(FullModel))

NSModel <- update(FullModel, . ~ . - (logCtFm + logCtFm:InstarNumber))

NSResults <- outputResultsWord(FullModel, NSModel)	
```
Rows removed with `r minN` or fewer data points.

The model with the lowest AIC value had instar age  x instar sex, 
nest size x instar age and the square of instar age as fixed effects

Nest size combined with the nest size x instar age interaction was significant
(lmer; $\chi$^2^~`r NSResults[[1]]` ,`r NSResults[[2]]`~= `r NSResults[[3]]`, p
= `r NSResults[[4]]` `r NSResults[[5]]`)


```{r LegLenVarInstarNumber, results='asis',  echo = FALSE}
##### Leg length vs colony size

InstModel <- update(FullModel, . ~ . - ( InstarNumber + InstarNumber:InstarSex + logCtFm:InstarNumber + I(InstarNumber^2)))

InstResults <- outputResultsWord(FullModel, InstModel)	
```

Tested together all the instar age terms, including the square of the instar
age, were significant (lmer; $\chi$^2^~`r Results[[1]]` ,`r InstResults[[2]]`~=
`r InstResults[[3]]`, p = `r InstResults[[4]]` `r InstResults[[5]]`, figure 5)
with the variance in leg length within nests being a curved function, peaking at
subadult instars.

```{r LegLenVarInstarSex, results='asis',  echo = FALSE}
##### Leg length vs colony size

InstSexModel <- update(FullModel, . ~ . - (InstarNumber:InstarSex))

InstSexResults <- outputResultsWord(FullModel, InstSexModel)	
```

However, even though it was included in the lowest AIC model, the instar age x
instar sex interaction was not significant (lmer;
$\chi$^2^~`r InstSexResults [[1]]` ,`r InstSexResults [[2]]`~=
`r InstSexResults [[3]]`, p = `r InstSexResults [[4]]`
`r InstSexResults [[5]]`). Doing adhoc tests on each instar age individually
against nest size we found that none were significant (figure 4).

```{r legVarUpdateGraph, fig.height=7, fig.width=13}


InstarGridGraph(legVarUpdate, "relativeVar", "Variance in leg length", "n", "", FullModel, "y")

```
  
(@)  Figure : Variance in leg length against colony size



```{r LegVarByInstarGraph, fig.height=4, fig.width=5, echo = FALSE}

#plot <- ggplot(data = legVarUpdate, aes(x = InstarNumber, y = relativeVar, group = Instar, fill = InstarSex)) +
#	labs(x = "Instar") + labs(y = "Variance in Leg Length") + geom_boxplot() + mytheme


#InstarModel
InstarOnlyModel <- lmer(relativeVar ~InstarNumber + I(InstarNumber^2) + (1|NestID), weights = lmrWgts,
    	data = legVarUpdate, REML = FALSE)
#anova(InstarOnlyModel)

a_predictDF <- expand.grid(InstarNumber = seq(4, 7, by = 0.1),  NestID = c("44.4EX12"))


a_predictDF$lmrPrd <- predict(InstarOnlyModel, a_predictDF)
plot <- ggplot(data = a_predictDF, aes(x = InstarNumber, y = lmrPrd)) + 
		labs(x = "Instar") + labs(y = "Variance in Leg Length") + geom_line() + mytheme

plot <- plot + geom_boxplot(data = legVarUpdate, aes(x = InstarNumber, y = relativeVar, group = Instar, fill = InstarSex)) + 
		scale_x_continuous(breaks=c(3,4,5,6,7, 8))

plot + geom_line(data = a_predictDF, aes(y= lmrPrd), size = 0.5)


```
   
(@) Figure :Leg length variance within colonies by instar. Overlaid is the
linear model.


### Condition Variance

```{r CondVarNS, results='asis',  echo = FALSE}

minN <- 2
condVarUpdate <- subset(condVar, N > minN)
totSpis <- sum(condVarUpdate$N)
condVarUpdate$lmrWgts <- condVarUpdate$N/ totSpis


FullModel <- lmer(relativeVar ~ logCtFm + InstarNumber + InstarNumber:InstarSex + I(InstarNumber^2) + 
				I(InstarNumber^2):InstarSex + (1|NestID), weights = lmrWgts, data = condVarUpdate, REML = FALSE)

modelList <- c(modelList, docxFmula(FullModel))

RedModNS <- update(FullModel, .~. - logCtFm)


NSResults <- outputResultsWord(FullModel, RedModNS)
	
```
The model with the lowest AIC included instar age, instar sex, instar age squared and the interaction instar age squared x instar sex.


Colony size was not significant (lmer; $\chi$^2^~`r NSResults[[1]]`
,`r NSResults[[2]]`~= `r NSResults[[3]]`, p = `r NSResults[[4]]`
`r NSResults[[5]]`),

```{r CondVarInstar, results='asis',  echo = FALSE}



RedModInt <- update(FullModel, .~. - (InstarNumber + I(InstarNumber^2) + InstarNumber:InstarSex + InstarSex:I(InstarNumber^2)))

IntResults <- outputResultsWord(FullModel, RedModInt)
	
```
but instar age was significant (lmer; $\chi$^2^~`r Results[[1]]`
,`r IntResults[[2]]`~= `r IntResults[[3]]`, p = `r IntResults[[4]]`
`r IntResults[[5]]`).


```{r CondVarInstarSexInteraction, results='asis',  echo = FALSE}


RedModIntSex <- update(FullModel, .~. -  (InstarNumber:InstarSex + InstarSex:I(InstarNumber^2)))
#formula(RedModIntSex)

IntSexResults <- outputResultsWord(FullModel, RedModIntSex)
	
```
In addition, the instar age x sex interaction was also significant (lmer; $\chi$^2^~`r Results[[1]]`
,`r IntSexResults[[2]]`~= `r IntSexResults[[3]]`, p = `r IntSexResults[[4]]`
`r IntSexResults[[5]]`), with the variance in condition within nests being larger for males compared to females (figure 7)


```{r ConditionVarGraph, fig.height=7, fig.width=13}


InstarGridGraph(condVarUpdate, "relativeVar", "Variance in Condition", "n", "", FullModel, "y")

```
  
(@)  Figure : Variance in condition against colony size


```{r instarCondVarGraph, fig.height=4, fig.width=5, echo = FALSE}

		
InstarOnlyModel <- lmer(relativeVar ~InstarNumber + I(InstarNumber^2) + (1|NestID), weights = lmrWgts, data = condVarUpdate, REML = FALSE)

		
a_predictDF <- expand.grid(InstarNumber = seq(4, 7, by = 0.1),  NestID = c("44.4EX12"))
		
		
a_predictDF$lmrPrd <- predict(InstarOnlyModel, a_predictDF)
		
		
		
plot <- ggplot(data = a_predictDF, aes(x = InstarNumber, y = lmrPrd)) + 
		labs(x = "Instar") + labs(y = "Variance in Condition") + geom_line() + mytheme
		
plot <- plot + geom_boxplot(data = condVarUpdate, aes(x = InstarNumber, y = relativeVar, group = Instar, fill = InstarSex)) + 
		scale_x_continuous(breaks=c(3,4,5,6,7, 8))
plot + geom_line(data = a_predictDF, aes(y= lmrPrd), size = 0.5)
		
```

(@) Figure :Condition Length variance within colonies by instar. Overlaid is the
linear model.




Biomass per capita vs colony size
====================

```{r Biomass, results='asis',  echo = FALSE}
##### Biomass per capita vs colony size


FullModel <- lmer(BiomsPerAdFm ~ log10AdFm + (1|ColonyID) + (1|Date), data = Biomass, REML = FALSE)
RedModel <- update(FullModel, ~. - log10AdFm)
#formula(RedModel)

Results <- outputResultsWord(FullModel, RedModel)

modelList <- c(modelList, docxFmula(FullModel))
	
```
Date and colony ID were used as random factors in the model.

Within the range of nests measured, biomass per capita increases as nest size increased (lmer; $\chi$^2^~`r Results[[1]]`
,`r Results[[2]]`~= `r Results[[3]]`, p = `r Results[[4]]`
`r Results[[5]]`).

```{r GraphBiomass, fig.height=4, fig.width=6}

plot <- ggplot(data = Biomass, aes(x = log10AdFm, y = BiomsPerAdFm)) + geom_point()
plot <- plot + xlab("Nest size - number of adult females") + ylab("Prey biomass per adult female") + mytheme

Vis_fit <- (visreg(FullModel, "log10AdFm", plot = FALSE))$fit						
plot <- plot +  geom_line(data = Vis_fit, aes(x = log10AdFm, y= visregFit))
plot

```
  
(@)  Figure : Prey biomass per capita was significant p = `r Results[[4]]`
`r Results[[5]]`). Model overlaid.




Original Colony Vs Propagule
============

```{r LegSing, results='asis',  echo = FALSE}
##### Leg length vs colony size


FullModel <- lmer(logLeg ~  type  +  (1|NestID) + (1|OrigNest) , data = nestsToTestSig, REML = FALSE)
NSModel <- lmer(logLeg ~   (1|NestID) + (1|OrigNest) , data = nestsToTestSig, REML = FALSE)

NSResults <- outputResultsWord(FullModel, NSModel)

modelList <- c(modelList, docxFmula(FullModel))
	
```
  
Leg length was larger in propagules compared to the source colony (lmer;
$\chi$^2^~`r NSResults[[1]]`,`r NSResults[[2]]`~= `r NSResults[[3]]`, p =
`r NSResults[[4]]` `r NSResults[[5]]`).



```{r CondSing, results='asis',  echo = FALSE}
##### Leg length vs colony size


FullModel <- lmer(condResiduals ~  type  +  (1|NestID) + (1|OrigNest) , data = nestsToTestSig, REML = FALSE)
NSModel <- lmer(condResiduals ~  (1|NestID) + (1|OrigNest) , data = nestsToTestSig, REML = FALSE)

NSResults <- outputResultsWord(FullModel, NSModel)

modelList <- c(modelList, docxFmula(FullModel))
	
```

as was condition (lmer; $\chi$^2^~`r NSResults[[1]]`,`r NSResults[[2]]`~=
`r NSResults[[3]]`, p = `r NSResults[[4]]` `r NSResults[[5]]`), with those in
propagules having a greater condition compared to those in the source nest.

```{r SingGraphs, fig.height=6, fig.width=12}

p1 <- ggplot(nestsToTestSigCond, aes(x=type, y=condResiduals)) + geom_boxplot() + 
		ylab("Individual Condition") + mytheme+ theme(axis.title.x = element_blank()) +
		scale_x_discrete(breaks=c("multiple", "single"), labels=c("source: multiple", "propagules: single"))

p2 <- ggplot(nestsToTestSig, aes(x=type, y=logLeg)) + geom_boxplot()  +
		mytheme +  theme(axis.title.x = element_blank()) +
		scale_x_discrete(breaks=c("multiple", "single"), labels=c("source: multiple", "propagules: single"))


grid.arrange(p1, p2, ncol = 2)


```
  
(@) Figure: Condition and leg length of adult females in propagues and their
source nest


Propagule survival
--------------------

We found that nests with single females spiders had a very low survival rate
(figure 5).

```{r PropaguleSurvivalGraph, fig.height=4, fig.width=7}

ggsurvplot(prop.survfit,color = "#2E9FDF", break.time.by = 5, 
		xlab = "Days until propagule death", ylab = "Propagule survival probability",  censor = FALSE)

nProps <- nlevels(props$propID)
nOriginalNests <- nlevels(props$nestID)

```
  
(@) Figure:  The survival function of `r nProps` propagules from `r nOriginalNests`
source nests.

List of full models used
-----------------------


```{r ModelTableForLA, results = 'asis'}

modelDF <- as.data.frame(modelList)
kable(modelDF, format = 'markdown')


```